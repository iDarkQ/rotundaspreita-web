generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OptionLetter {
  A
  B
  C
  D
  E
}

model User {
  id       String @id @default(cuid())
  googleId String @unique
  email    String @unique
  name     String

  admin Boolean @default(false)

  banned    Boolean  @default(false)
  createdAt DateTime @default(now())

  deviceSessions DeviceSession[]
  // testSession    TestSession?    @relation(fields: [testSessionId], references: [id], onDelete: Cascade)
  // testSessionId  String?         @unique
}

model DeviceSession {
  id        String @id @default(cuid())
  ipAddress String
  userAgent String
  jwtToken  String

  lastActive DateTime @default(now())

  userId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// model TestSession {
//   id String @id @default(cuid())

//   testQuestions TestQuestion[]

//   user      User?
// }

// model TestQuestion {
//   id String @id @default(cuid())

//   questionId String
//   question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
//   optionId   String?
//   option     Option?   @relation(fields: [optionId], references: [id], onDelete: Cascade)

//   testSession   TestSession? @relation(fields: [testSessionId], references: [id])
//   testSessionId String?
// }

model Study {
  id          String     @id @default(cuid())
  title       String
  description String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  questions   Question[]
}

model Question {
  id        String   @id @default(cuid())
  content   String
  category  String?
  studyId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  study   Study    @relation(fields: [studyId], references: [id])
  answer  Answer?  @relation(fields: [answerId], references: [id])
  options Answer[] @relation("QuestionOptions")
}

model Answer {
  id         String       @id @default(cuid())
  content    String
  letter     AnswerLetter
  questionId Int
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  question  Question   @relation("QuestionOptions", fields: [questionId], references: [id])
  questions Question[]
}
